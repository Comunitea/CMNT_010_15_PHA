<?xml version="1.0" encoding="utf-8"?>
<openerp>
<data>

    <!-- Vista qweb de prueba que lista los productos a consumir de una produccion -->
    <template id="stock_move_mrp_consume" name="Moves to consume">
        <div class="wrap">
            <div class="container">
                <div class="row">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Fecha:</th>
                            </tr>
                            <tr>
                                <th>Material</th>
                                <th>Lote</th>
                                <th>Fecha aceptado por C.Calidad</th>
                                <th>Cantidad a servir</th>
                                <th>Cantidad servida</th>
                                <th>Iniciales</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="production.move_lines" t-as="move">
                                <td><span t-field='move.product_id.name' /></td>
                                <td><span t-if='move.reserved_quant_ids and move.reserved_quant_ids[0].lot_id' t-field='move.reserved_quant_ids[0].lot_id.name' /></td>
                                <td></td>
                                <td><span t-field='move.product_qty'/> <span t-field='move.product_uom.name'/></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </template>

    <!-- Vista de prueba usada como cabecera del protocolo de produccion -->
    <template id="production_header" name="Production header">
       <div>
            <p>PRODUCTO: <span t-field='production.product_id.name' /></p>
            <p>LOTE: <span t-if='production.final_lot_id' t-field='production.final_lot_id.name' /></p>
            <form role="form" method="post" class="oe_form" t-att-model="production._name" t-att-record="production.id">
                <p>CANT: <input class="form-control" name="product_qty" t-att-value='production.product_qty' type="numeric"/></p>
                <table class="oe_list_content oe_form_field_one2many quality_field" id="tblAppendGrid" t-att-qfield="'adjustsments_ids'"
                      t-att-columns="'start_date,name,reanudation_date,initials,id'">
                </table>
            </form>
       </div>
    </template>

    <!-- Vista generica de impresion de surveys -->
    <template id="generic_survey" name="Generic survey template">
        <div class="wrap">
            <div class="container">
                <div t-field='survey.title' class="oe_no_empty"/>
                <t t-foreach="survey.page_ids" t-as="page">
                    <div class="survey_page">
                            <input type="hidden" name="survey_id" t-att-value="survey.id" />
                            <!--Campo añadido para evitar errores en el servidor -->
                            <input type="hidden" name="button_submit" value=""/>
                            <input type="hidden" name="token" t-att-value="token" />
                            <div class="page-header">
                                <h1 t-field='page.title' />
                                <t t-if="page.description"><div t-field='page.description' class="oe_no_empty"/></t>
                            </div>
                            <t t-foreach='page.question_ids' t-as='question'>
                                <t t-set="prefix" t-value="'%s_%s_%s' % (survey.id, page.id, question.id)" />
                                <div class="js_question-wrapper" t-att-id="prefix">
                                    <h2>
                                        <span t-field='question.question' />
                                        <span t-if="question.constr_mandatory" class="text-danger">*</span>
                                        <span t-if="quizz_correction" class="badge" t-att-data-score-question="question.id"></span>
                                    </h2>
                                    <t t-if="question.description"><div class="text-muted oe_no_empty" t-field='question.description'/></t>
                                    <t t-if="question.type == 'free_text'"><t t-call="survey.free_text"/></t>
                                    <t t-if="question.type == 'textbox'"><t t-call="survey.textbox"/></t>
                                    <t t-if="question.type == 'numerical_box'"><t t-call="survey.numerical_box"/></t>
                                    <t t-if="question.type == 'datetime'"><t t-call="survey.datetime"/></t>
                                    <t t-if="question.type == 'simple_choice'"><t t-call="survey.simple_choice"/></t>
                                    <t t-if="question.type == 'multiple_choice'"><t t-call="survey.multiple_choice"/></t>
                                    <t t-if="question.type == 'matrix'"><t t-call="survey.matrix"/></t>
                                    <div class="js_errzone alert alert-danger" style="display:none;"></div>
                                </div>
                            </t>
                    </div>
                </t>
        </div>
        </div>
    </template>

    <template id="assets_backend" inherit_id="web.assets_backend" name="Survey assets">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/quality_protocol_report/static/src/js/quality_survey.js" />
            <script type="text/javascript" src="/quality_protocol_report/static/src/js/jquery.appendGrid-1.4.2.min.js" />
        </xpath>
    </template>

    <!-- Vista contenedora para el prototipo, se debe mirar como se puede generar al vuelo, desde el controller -->
    <template id="protocol_print" name="Protocol">
        <t t-call="web.layout">
            <t t-set="head">
                <link rel="stylesheet" href="/quality_protocol_report/static/src/css/jquery.appendGrid-1.4.2.css"/>
                    <t t-call-assets="web.assets_common"/>
                    <t t-call-assets="web.assets_backend"/>
            </t>
            <div class="wrap">
                <div class="container">
                    <!--div groups="base.group_website_publisher" t-ignore="true" class="text-right">
                        <a href="#" class="btn btn-default">P</a>

                    </div-->
                    <!--Para no modificar las vistas de cada tipo de pregunta, si la encuesta ya fue respondida
                        se añade un div id=exist y desde static/src/js/survey.js se rellenan las respuestas por ajax. -->
                    <t t-if="exist != False">
                        <div id="exist"></div>
                    </t>
                    <div class="row">
                        <div id="all_data">
                            <t t-set="parts" t-value="parts"/>
                            <div t-foreach="parts" t-as="part">
                                <t t-if="part[0] == 's'">
                                    <div class="survey" t-att-fill="'/protocol/fill/%s/%s' % (slug(part[1]), part[2])" t-att-url-submit="'/protocol/submit/%s' % (slug(part[1]))">
                                        <form role="form" method="post" class="js_surveyform" t-att-data-submit="'/protocol/submit/%s' % (slug(part[1]))">
                                            <t t-call="quality_protocol_report.generic_survey">
                                                <t t-set="survey" t-value="part[1]"/>
                                                <t t-set="token" t-value="part[2]"/>
                                            </t>
                                        </form>
                                    </div>
                                </t>
                                <t t-if="part[0] == 'v'">
                                    <div class="view">
                                        <t t-call="#{part[1]}"/>
                                    </div>
                                </t>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" name="button_submit" value="finish" id="send_form">Submit</button>
                        <div class="js_errzone alert" id="general_info" style="display:none;"></div>
                    </div>
                </div>
            </div>
        </t>
    </template>

</data>
</openerp>
